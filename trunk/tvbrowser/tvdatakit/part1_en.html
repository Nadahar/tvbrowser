<html>

	<head>
		<title>TV-Browser</title>
       <link rel="stylesheet" type="text/css" href="style.css">
	</head>
	<body>


<h1>PROVIDING TV LISTINGS FOR TV-BROWSER</h1>
<h2>using the TV-Browser tools</h2>
<h1>Part I</h1>



<p>
In part I of the tutorial we will use fictitious tv listings that the TV-Browser web site generates. The tools I have mentioned are responsible for processing these listings and uploading them to a webserver. After that, TV-Browser can access the listings on the server.<br />
After having worked through part I, you should understand the basics on how tv listings are processed and you will be able to set up a working environment for the TV-Browser tools.<br />
To keep the tutorial simple and concise, I will only explain the things that are crucial for understanding the process.<br />
At the end of part I we will add a new channel group to TV-Browser. This group will contain three channels with fictitious listings that reside on the web space.
</p>

<h4>Requirements:</h4>
<ul>
<li>Interest in the way the listings are processed</li>
<li>Webspace for publishing the tv listings</li>
<li>Ftp account on the webspace</li>
<li>Operating system that supports TV-Browser</li>
<li>No programming skills are needed</li>
</ul>


<p>
Throughout the tutorial we will need the dos box, terminal, console or whatever it may be called on your system.<br />
So, fist of all we open a terminal window and change to the directory <em>workspace</em>. This will be the directory we will work in (I will explain the meaning of the other directories later).<br />
In the directory you can see several shell scripts, each of them available in two versions - one for windows and the other for the *nix bash. Each script corresponds to a TV-Browser tool: PDSRunner, DataManager and MirrorUpdater. Those scripts will save us a lot of typing.<br />
</p>

<h3>Step 1: Using PDSRunner to generate raw listings data</h3>
<p>
The first tool that we need is the <em>PDSRunner</em>. PDSRunner reads tv listings and converts them to a special format in order to facilitate further processing.
</p>
<p>
We start PDSRunner with the command
</p>
<pre>pdsrunner</pre>
<p>
We see the following output:</p>
<pre>usage: PDSRunner [-raw directory] [-log directory] pds ...</pre>
<p>What does that mean?<br />
The task of PDSRunner is collecting the tv listings. The tool does this by calling external "modules" (Java classes) that provide the listings.<br />
We (the developers) call these modules PrimaryDataServices, or PDS in short. The only time that a listings provider must do programming work is during development of such a PDS.<br />
In this part of the tutorial we will skip this step. Instead, we will use the PDS that is delivered along with the tutorial.
</p>
<p>
We need to tell the PDSRunner what PDS it shall use. This is how we do it:
</p>
<pre>pdsrunner SimplePDS</pre>


<p>
SimplePDS is, as its name implies, a very simple PDS. It downloads tv listings from <a href="http://www.tvbrowser.org/pdsstarterkit/">a web site</a> and passes them to the PDSRunner. Both channel and listings are purely fictitious and are there only to demonstrate how the process works. The PDS resides in the <em>java</em> directory.
</p>

<p>
After PDSRunner has completed we see that a new directory named <em>raw</em> has been created in the <em>workspace</em> directory. The new directory contains one file for each combination of day and channel. The files themselves contain the raw listings data.
</p>
<p class="note">
The tv listings originate from the TV-Browser web site and were generated by an automatic process on the web server.<br />
SimplePDS has extracted these listings from the web site.<br />
PDSRunner has started SimplePDS and has converted the tv listings returned by SimplePDS to the format that the other tools understand. PDSRunner has then stored the converted listings to the <em>raw</em> directory.<br />
The original listings can be viewed <a href="http://www.tvbrowser.org/pdsstarterkit/">here</a>.
</p>
<p>
Because the raw listings are stored in a binary format that is compressed we cannot easily open them and see their contents. Luckily there is another tool that makes the listings readable for humans :-) <br />
The command
</p>
<pre>dayprogramfiletranslator raw</pre>
<p>
creates text files corresponding to the binary files in the <em>raw</em> directory and stores them in the directory <em>raw/txt</em>. We can open and inspect these files to see whether everything is still all right.
</p>

<p class="note">
You do not really need to use DayProgramFileTranslator to provide tv listings. It is just a tool to display listings in the binary format.
</p>


<h3>Step 2: Using DataManager to prepare listing files for upload</h3>
<p>
As they are, the files cannot yet be used in TV-Browser. The reason is that TV-Browser requires additional information, such as:
</p>
<ul>
<li>the list of mirror servers - alternative servers offering the same listings</li>
<li>the list of channels for which you provide listings</li>
<li>different versions of the listings of one day: If there have been changes to the tv listings after you first published them, TV-Browser will download only those changes and integrate them into the listings it already has.</li>
<li>information about the channels (name. time zone, web site etc.)</li>
</ul>

<p>
To help TV-Browser find the information on the web server DataManager creates some additional files-<br />
First of all, we need to set up DataManager.<br />
</p>

<p>
To do this, we change to the directory <em>config</em>.<br />
It contains 3 files:
</p>
<ul>
<li>myfirstgroup.txt</li>
<li>myfirstgroup_mirrorlist.txt</li>
<li>myfirstgroup_channellist.txt</li>
</ul>

<p>
Each of them can be opened and edited in any text editor.
</p>
<p>
Let's start with the file <em>myfirstgroup.txt</em>: It contains the name and description of our group. By default, entries for several other languages are added. You can edit the strings following the '=' sign as you wish.
</p>
<p class="note">
<em>myfirstgroup</em> is the name of our group. This name is defined in SimplePDS and should not concern us further. In <a href="part2_en.html">part II</a> we will learn how to customize this name.
</p>

<p>
<em>myfirstgroup_channellist.txt</em> contains a list of the channels that you will provide (more precisely, the channels belonging to the group <em>myfirstgroup</em>). We need not edit this file because it already contains appropriate test data.
</p>

<p>
<em>myfirstgroup_mirrorlist.txt</em> must be changed, however: It contains a list of those servers that will carry our channel group. For most purposes, one entry will suffice. If you want provide the listings on several mirrors you need to add all of the to the file. For a start, we will use just one entry.<br />
</p>
<p>
The file <em>myfirstgroup_mirrorlist</em> might, for example, contain something like:
</p>
<pre>http://www.tvbrowser.org/tv-daten-test/
</pre>
<p>
In this case, the directory <em>tv-daten-test</em> must exist on the web server.<br />
It is important to create a separate subdirectory on the webspace for the tv listings. This is much tidier and, since the tools will create a file named <em>index.html</em>, it will not mess up your web page :-).<br />
</p>
<p class="note">
Now is a good time to create the subdirectory where the tv listings will be stored.
</p>

<p>
After having edited and saved the two files we can start DataManager:
</p>
<pre>datamanager myfirstgroup</pre>

<p>
DataManager must know for which channel group to process the raw listings. If you provide multiple channel groups you may process all of them at once by listing all group identifiers separated by blanks.
</p>

<p>
Once DataManager is done the directory <em>prepared</em> holds many new files. These are the files we will upload to the webspace later on. To save bandwidth all the files have been compressed.
</p>

<p>
What exactly has DataManager done? <br />
DataManager has read all the files in the <em>raw</em> directory and created a new version of each file in the <em>prepared</em> directory. If a previous version of a file (identified by channel and date) already existed in the <em>prepared</em>  directory the DataManager has created a file containing the changes to the most recent version. DataManager will re-use the information in the <em>prepared</em> directory each time it is run.
</p>

<p class="note">
NO FILES MAY BE DELETED FROM THE <em>PREPARED</em> FOLDER. DataManager requires the files in the <em>prepared</em> folder to determine the changes that were made to the listings. For this reason, you must not remove files from the <em>prepared</em> folder.<br />
If files were removed from the <em>prepared</em> folder, the listings would no longer be the same as those that the user has already downloaded. As a consequence, TV-Browser would not realize that the listings for that day and channel have changed and would never download the new listings.
immen die Daten nicht mehr mit denen zusammen, die der Benutzer bereits heruntergeladen hat. Folglich l&auml;dt TV-Browser keine Programm&auml;nderungen mehr f&uuml;r den entsprechenden Tag und Sender.
</p>


<p>
Now we are ready for step 3.
</p>

<h3>Step 3: Uploading the listings using MirrorUpdater</h3>

<p>
The third and last tool called MirrorUpdater will upload the listings files to the webspace. First, though, we have to configure MirrorUpdater; for this purpose, we open the file <em>mirrorupdater.ini</em> in a text editor and make the necessary changes.
I have already edited the .ini file such that you need to add only the login information for the ftp server.
<em>url</em> denotes the ftp server and <em>path</em> stands for the folder to which the listings will be copied (this folder must already exist; MirrorUpdater will not create it).
In addition, MirrorUpdater requires a user name and password to access the webspace by ftp. You need not change the other lines; nonetheless, I will describe their meaning below:
</p>
<table>
<tr>
<td><pre>dataSource.type=file</pre></td>
<td>The files are read from the local file system.
</tr>
<tr>
<td><pre>dataSource.dir=prepared</pre></td>
<td>We use the listings files in the <em>prepared</em> folder.<br />DataManager has created these files for us in step 2.</td>
</tr>
<tr>
<td><pre>dataTarget.type=ftp</pre></td>
<td>We upload the files to an ftp server.
</tr>
<tr>
<td><pre>groups=myfirstgroup</pre></td>
<td>We are interested in the channel group <em>myfirstgroup</em>.</td>
</tr>
<tr>
<td><pre>mirror.weight=-1</pre></td>
<td>If we had multiple mirrors for the listings, we could set the weight of the mirror here. In this example with one server, however, we don't need a weight.
</td>
</tr>
</table>

<p>
Now we run MirrorUpdater with the command
</p>
<pre>mirrorupdater mirrorupdater.ini</pre>
<p>
MirrorUpdater receives as its argument the configuration file we just edited.
When MirrorUpdater has finished uploading the files, you should be able to download the listings with your TV-Browser client.
</p>


<h3>Step 4: Activating the new channel group in TV-Browser</h3>
<p>
If MirrorUpdater completed without an error message, we look at the server to make sure the listings have really been uploaded.
</p>
<p>
For example, I would visit the url http://www.tvbrowser.org/tv-daten-test/. The web browser should show a website. Additionally, I can see the channel group file at http://www.tvbrowser.org/tv-daten-test/myfirstgroup_info.
</p>

<p class="note">
The websites used in the example do not exist. Change the urls accordingly.
</p>

<p>
Finally, we start TV-Browser and add the channel group:
Settings --> TVDataServices --> TVBrowser --> Channel groups.<br />
Click "Add" and enter the url pointing to your channel group.
For example, if the listings are stored at http://members.meinprovider.de/myhome/tvdata, we enter http://members.meinprovider.de/myhome/tvdata/myfirstgroup.
</p>

<p>
If everything worked, we can update the channel list to see our new channels in the TV-Browser client!
</p>

<p class="note">
Any questions? Something didn't work as it should have? Just ask in <a href="http://hilfe.tvbrowser.org">our forum</a> and I will gladly help.
</p>

<p>
<table width="100%">
<tr>
<td><a href="index-en.html">Overview</a></td>
<td align="right"><a href="part2_en.html">On to part II</a></td>
</tr>
</table>

</p>

	</body>
</html>
