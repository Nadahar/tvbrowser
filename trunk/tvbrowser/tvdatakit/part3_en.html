<html>

<head>
  <title>TV-Browser</title>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>

<h1>PROVIDING TV LISTINGS FOR TV-BROWSER</h1>
<h2>using the TV-Browser tools</h2>
<h1>Part III</h1>

<p>
<table>
<tr>
<td><strong>Author:</strong></td>
<td>Til Schneider</td>
</tr>
<tr>
<td><strong>Translated by:</strong></td>
<td>Lena Pammer</td>
</tr>

</table>
</p>

<p>
This is part III of the tutorial about providing tv listings. It assumes that you have successfully completed parts I and II. We will use the same tools as in these parts.
</p>
<p>
In part I. we used a Java program to retrieve the tv listings from the source (this program was called a PrimaryDataService or PDS). During part II, we entered the lsitings manually. This part of the tutorial is aimed at those who want to write a program for collecting tv listings that is implemented in a different programming language.
</p>
<p>
Processing the tv listings with a non-Java-collector happens in two stages:
<ol>
  <li>The listings collector generates an xml file containing all listings.</li>
  <li>The xml file is passed to a PDS that can read it. The listings are then processed as usual.</li>
</ol>
</p>
<p>
Because we will work on a complete xml file and focus on the second stage, no knowledge about programming will be necessary for this part of the tutorial.
</p>
<p>
THe manner of generating the xml file is the sole responsibility of the person programming the listings collector. If you must, you may also manually generate the file. But as mentioned, the tutorial comes with a complete xml file, which we will use.
</p>


<h3>The file <em>TvData.xml</em></h3>
<p>
We will use the xml format <a href="http://membled.com/work/apps/xmltv" target="_blank">XMLTV</a>. Some parts of the tv listings are not supported by XMLTV; for these parts, the format was extended somewhat. If you do not need the additional elements, you can simply use valid XMLTV for your listings files.
</p>
<p>
<em>TvData.xml</em> is the file that the listings collector should overwrite. It contains all the tv listings.
</p>
<p>
Now we open <em>TvData.xml</em> in a text editor. The file contains a <em>&lt;programme&gt;</em tag for each program. The order of these tags within the file makes no difference.
</p>
<p>
The first tag in this example contains a describing comment before each subtag. It contains all information tags that can be specified for a program. But don't despair: You need not fill all the subtags for each programs (though you can). All you really have to add is marked by the text <em>(required)</em> in the description: These subtags are the channel ID, the start time and the title of the program.
</p>
<p>
A minimal tag for a program might for example be:
<pre>
&lt;programme channel="<b>test24_ch</b>" start="<b>200407101100</b>"&gt;
  &lt;title&gt;<b>News</b>&lt;/title&gt;
&lt;/programme&gt;
</pre>
</p>
<p>
The channel ID consists of two parts: the ID itself and the <a href="http://www.chemie.fu-berlin.de/diverse/doc/ISO_3166.html">country code</a> (already described in part II).
</p>
<p>
All times have the following format according to XMLTV:
<ul>
  <li>Year (4 digits)</li>
  <li>Month (2 digits)</li>
  <li>Day (2 digits)</li>
  <li>Hours (2 digits)</li>
  <li>Minutes (2 digits)</li>
</ul>
</p>
<p>
Hence, <em>200407101100</em> means: July 10, 2004 at 11:00.
</p>
<p>
Right now, <em>TvData.xml</em> contains few programs. You can add a few programs yourself, so that there will be more to see later on. Just make sure that the channel IDs you use are among those defined in <em>[GROUPID]_channels.txt</em> (in the <em>config</em> folder)!
</p>
<p>
When you feel there are enough programs for now, save the file.
</p>
<p>
Now we can start our first test run. Just like in parts I and II, we invoke PDSRunner with the command
</p>
<pre>
pdsrunner XmlTvPDS
</pre>
<p>
If any errors occurred, the error messages can be found in the <em>pdslog</em> folder as usual. Otherwise, the raw listings have been written to the <em>raw</em> folder. The listings need to be processed by DataManager and can then be uploaaded by MirrorUpdater. However, these two tools must first be configured. The procedure is the same as the one described in part II, <a href="part2_de.html#configuration" target="_blank">Configuring DataManager and MirrorUpdater</a>. The only difference is that we use XmlTvPDS instead of ExcelPDS.
</p>

<h3>Keeping your listings up to date</h3>
<p>
As always, you must take care to regularly update the listings on your server. Every time you want to update the listings, you run the listings collector, which will generate a new version of <em>TvData.xml</em>. After that, you invoke the TV-Browser tools:
</p>
<pre>
pdsrunner XmlTvPDS
datamanager [GROUPID]
mirrorupdater mirrorupdater.ini
</pre>
<p class="note">
<strong>Important note:</strong> To avoid that TV-Browser loads listings from servers that contain outdated listings, the MirrorUpdater stores a file named <em>lastupdate</em> on each server.<br />
TV-Browser will not use servers that have not been updated for more than five days. Hence, a listings provider has to update his servers at least every five days.
</p>

<p>DataManager requires the files in the <em>prepared</em> folder to determine the changes that were made to the listings. For this reason, you must not remove files from the <em>prepared</em> folder.<br />
If files were removed from the <em>prepared</em> folder, the listings would no longer be the same as those that the user has already downloaded. As a consequence, TV-Browser would not realize that the listings for that day and channel have changed and would never download the new listings.
</p>




<p>
<table width="100%">
<tr>
<td align="left"><a href="part2_en.html">Back to part II</a></td>
<td align="center"><a href="index_en.html">Overview</a></td>
<td align="right"><!-- <a href="part4_en.html">On to part IV</a> --></td>
</tr>
</table>

</p>

</body>
</html>
